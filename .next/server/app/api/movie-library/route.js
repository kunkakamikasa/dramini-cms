"use strict";(()=>{var e={};e.id=6158,e.ids=[6158],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},44687:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>h,originalPathname:()=>U,patchFetch:()=>f,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>I,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>b});var a={};t.r(a),t.d(a,{GET:()=>m,POST:()=>p,dynamic:()=>c});var n=t(95419),s=t(69108),i=t(99678),o=t(78070),l=t(3214),u=t(6113),d=t.n(u);let c="force-dynamic";async function m(e){try{let{searchParams:r}=new URL(e.url),t=r.get("online"),a={};"true"===t&&(a.status="PUBLISHED");let n=(await l._.titles.findMany({where:a,select:{id:!0,name:!0,slug:!0,synopsis:!0,coverImageId:!0,bannerUrl:!0,status:!0,language:!0,categoryId:!0,rating:!0,createdAt:!0,updatedAt:!0,categories:{select:{id:!0,name:!0}},episodes:{select:{id:!0}},users_titles_createdByIdTousers:{select:{name:!0}}},orderBy:{createdAt:"desc"}})).map(e=>({...e,createdBy:e.users_titles_createdByIdTousers,isOnline:"PUBLISHED"===e.status,mainTitle:e.name,subTitle:e.synopsis,coverUrl:e.coverImageId,bannerUrl:e.bannerUrl}));return o.Z.json(n)}catch(e){return console.error("Failed to fetch movies:",e),o.Z.json([],{status:500})}}async function p(e){try{let r=await e.json();if(console.log("Creating movie with data:",r),!r.name||!r.slug)return o.Z.json({error:"Name and slug are required"},{status:400});let t=await l._.titles.create({data:{id:d().randomUUID(),name:r.name,slug:r.slug,synopsis:r.synopsis||null,coverImageId:r.coverImageId||null,bannerUrl:r.bannerUrl||null,categoryId:r.categoryId||null,language:r.language||"zh",status:r.status||"DRAFT",createdById:"admin-1",updatedById:"admin-1",updatedAt:new Date}});return o.Z.json(t)}catch(e){return console.error("Failed to create movie:",e),o.Z.json({error:"Failed to create movie",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/movie-library/route",pathname:"/api/movie-library",filename:"route",bundlePath:"app/api/movie-library/route"},resolvedPagePath:"/Users/mayingkun/mkwork/cursorproject/H5/DraminiCMS/app/api/movie-library/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:v,serverHooks:I,headerHooks:h,staticGenerationBailout:b}=g,U="/api/movie-library/route";function f(){return(0,i.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:v})}},3214:(e,r,t)=>{t.d(r,{_:()=>n});var a=t(53524);let n=globalThis.prisma??new a.PrismaClient}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[1638,6206],()=>t(44687));module.exports=a})();