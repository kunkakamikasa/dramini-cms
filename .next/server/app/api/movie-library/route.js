"use strict";(()=>{var e={};e.id=6158,e.ids=[6158],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},44687:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>h,originalPathname:()=>f,patchFetch:()=>U,requestAsyncStorage:()=>g,routeModule:()=>y,serverHooks:()=>v,staticGenerationAsyncStorage:()=>b,staticGenerationBailout:()=>P});var n={};t.r(n),t.d(n,{GET:()=>p,POST:()=>m,dynamic:()=>c});var a=t(95419),i=t(69108),s=t(99678),o=t(78070),l=t(3214),u=t(6113),d=t.n(u);let c="force-dynamic";async function p(e){try{let{searchParams:r}=new URL(e.url),t=r.get("hasBanner"),n=r.get("online"),a={};"true"===t&&(a.bannerUrl={not:null}),"true"===n&&(a.isOnline=!0);let i=await l._.titles.findMany({where:a,include:{categories:{select:{id:!0,name:!0}},episodes:{select:{id:!0}},users_titles_createdByIdTousers:{select:{name:!0}}},orderBy:{createdAt:"desc"}});return o.Z.json(i)}catch(e){return console.error("Failed to fetch movies:",e),o.Z.json([],{status:500})}}async function m(e){try{let r=await e.json();if(console.log("Creating movie with data:",r),!r.name||!r.slug)return o.Z.json({error:"Name and slug are required"},{status:400});let t=await l._.titles.create({data:{id:d().randomUUID(),name:r.name,mainTitle:r.mainTitle||null,subTitle:r.subTitle||null,slug:r.slug,synopsis:r.synopsis||null,coverUrl:r.coverUrl||null,bannerUrl:r.bannerUrl||null,categoryId:r.categoryId||null,language:r.language||"zh",status:r.status||"DRAFT",isOnline:r.isOnline||!1,freeUntilEpisode:r.freeUntilEpisode?parseInt(r.freeUntilEpisode):null,bundlePrice:r.bundlePrice?Math.round(100*parseFloat(r.bundlePrice)):null,bundlePriceCurrency:r.bundlePriceCurrency||"CNY",bundlePriceCoins:r.bundlePriceCoins?parseInt(r.bundlePriceCoins):null,createdById:"system",updatedById:"system",updatedAt:new Date}});return o.Z.json(t)}catch(e){return console.error("Failed to create movie:",e),o.Z.json({error:"Failed to create movie",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let y=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/movie-library/route",pathname:"/api/movie-library",filename:"route",bundlePath:"app/api/movie-library/route"},resolvedPagePath:"/Users/mayingkun/mkwork/cursorproject/H5/DraminiCMS/app/api/movie-library/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:b,serverHooks:v,headerHooks:h,staticGenerationBailout:P}=y,f="/api/movie-library/route";function U(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:b})}},3214:(e,r,t)=>{t.d(r,{_:()=>a});var n=t(53524);let a=globalThis.prisma??new n.PrismaClient}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[1638,6206],()=>t(44687));module.exports=n})();