"use strict";(()=>{var e={};e.id=9847,e.ids=[9847],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},258:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>h,originalPathname:()=>P,patchFetch:()=>_,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>g});var a={};r.r(a),r.d(a,{GET:()=>c});var s=r(95419),o=r(69108),i=r(99678),n=r(78070),u=r(3214);async function c(){try{let[e,t,r,a,s,o,i,c]=await Promise.all([u._.titles.count(),u._.titles.count({where:{status:"PUBLISHED"}}),u._.titles.count({where:{status:"DRAFT"}}),u._.episodes.count(),u._.users.count(),u._.purchase.count({where:{status:"COMPLETED"}}),u._.purchase.aggregate({where:{status:"COMPLETED"},_sum:{amountCents:!0}}),u._.flagReport.count({where:{status:"PENDING"}})]),d=await u._.auditLog.findMany({take:4,orderBy:{createdAt:"desc"},include:{actor:{select:{name:!0,email:!0}}}}),p={totalTitles:e,publishedTitles:t,draftTitles:r,totalEpisodes:a,totalUsers:s,totalPurchases:o,totalRevenue:i._sum.amountCents||0,pendingTranscodes:0,pendingReports:c},l=d.map(e=>({id:e.id,type:e.action.toLowerCase(),message:`${e.entity} ${e.action}`,createdAt:e.createdAt,user:e.actor}));return n.Z.json({metrics:p,recentActivity:l})}catch(e){return console.error("Dashboard API error:",e),n.Z.json({error:"Failed to fetch dashboard data"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/dashboard/metrics/route",pathname:"/api/dashboard/metrics",filename:"route",bundlePath:"app/api/dashboard/metrics/route"},resolvedPagePath:"/Users/mayingkun/mkwork/cursorproject/H5/DraminiCMS/app/api/dashboard/metrics/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:l,serverHooks:m,headerHooks:h,staticGenerationBailout:g}=d,P="/api/dashboard/metrics/route";function _(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}},3214:(e,t,r)=>{r.d(t,{_:()=>s});var a=r(53524);let s=globalThis.prisma??new a.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206],()=>r(258));module.exports=a})();