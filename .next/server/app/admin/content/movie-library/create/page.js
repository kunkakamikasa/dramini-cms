(()=>{var e={};e.id=9203,e.ids=[9203],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},31366:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>o,routeModule:()=>u,tree:()=>c});var s=t(50482),a=t(69108),i=t(62563),l=t.n(i),n=t(68300),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);t.d(r,d);let c=["",{children:["admin",{children:["content",{children:["movie-library",{children:["create",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,82933)),"/Users/mayingkun/mkwork/cursorproject/H5/DraminiCMS/app/admin/content/movie-library/create/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,66294)),"/Users/mayingkun/mkwork/cursorproject/H5/DraminiCMS/app/admin/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,78062)),"/Users/mayingkun/mkwork/cursorproject/H5/DraminiCMS/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,69361,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/mayingkun/mkwork/cursorproject/H5/DraminiCMS/app/admin/content/movie-library/create/page.tsx"],m="/admin/content/movie-library/create/page",x={require:t,loadChunk:()=>Promise.resolve()},u=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/content/movie-library/create/page",pathname:"/admin/content/movie-library/create",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},88168:(e,r,t)=>{Promise.resolve().then(t.bind(t,73001))},73001:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>y,dynamic:()=>b});var s=t(95344),a=t(3729),i=t(22254),l=t(16212),n=t(92549),d=t(61351),c=t(93601),o=t(63024),m=t(20016),x=t(3380),u=t(42739),p=t(31498),g=t(20783),h=t.n(g),f=t(44669);let b="force-dynamic";function y(){let e=(0,i.useRouter)(),[r,t]=(0,a.useState)(!1),[g,b]=(0,a.useState)([]),[y,v]=(0,a.useState)(!1),[j,N]=(0,a.useState)(!1),k=(0,a.useRef)(null),w=(0,a.useRef)(null),[P,C]=(0,a.useState)({name:"",mainTitle:"",subTitle:"",slug:"",synopsis:"",coverImageId:"",bannerUrl:"",categoryId:"",language:"zh",status:"DRAFT",isOnline:!1});(0,a.useEffect)(()=>{I()},[]);let I=async()=>{try{let e=await fetch("/api/categories");if(e.ok){let r=await e.json();b(r)}}catch(e){console.error("Failed to fetch categories:",e)}},Z=(e,r)=>{if(C(t=>({...t,[e]:r})),"name"===e&&r){let e=r.toLowerCase().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"");C(r=>({...r,slug:e}))}},T=async(e,r)=>{let t=e.target.files?.[0];if(!t)return;if(!t.type.startsWith("image/")){f.ZP.error("请选择图片文件");return}if(t.size>5242880){f.ZP.error("图片文件不能超过 5MB");return}let s="cover"===r?v:N;s(!0);try{let e=new FormData;e.append("file",t),e.append("type",r);let s=await fetch("/api/upload",{method:"POST",body:e});if(s.ok){let e=await s.json();console.log("Upload result:",e),C(t=>({...t,["cover"===r?"coverImageId":"bannerUrl"]:e.imageUrl})),console.log("Updated formData:",P),f.ZP.success(`${"cover"===r?"封面图":"轮播图"}上传成功`)}else f.ZP.error("图片上传失败")}catch(e){f.ZP.error("上传失败")}finally{s(!1)}},z=async r=>{if(r.preventDefault(),!P.name.trim()){f.ZP.error("请填写影片名称");return}if(!P.mainTitle.trim()){f.ZP.error("请填写主标题");return}if(!P.subTitle.trim()){f.ZP.error("请填写副标题");return}if(!P.coverImageId.trim()){f.ZP.error("请上传9:16封面图");return}if(!P.categoryId){f.ZP.error("请选择分类");return}t(!0);try{let r=await fetch("/api/movie-library",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)});if(r.ok)f.ZP.success("影片添加成功"),e.push("/admin/content/movie-library");else{let e=await r.text();f.ZP.error("创建失败: "+e)}}catch(e){f.ZP.error("网络错误")}finally{t(!1)}};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[s.jsx(h(),{href:"/admin/content/movie-library",children:(0,s.jsxs)(l.z,{variant:"outline",size:"sm",children:[s.jsx(o.Z,{className:"h-4 w-4 mr-2"}),"返回影片库"]})}),(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"添加影片"}),s.jsx("p",{className:"text-gray-600",children:"添加新影片到影片库"})]})]}),(0,s.jsxs)(d.Zb,{children:[s.jsx(d.Ol,{children:s.jsx(d.ll,{children:"影片信息"})}),s.jsx(d.aY,{children:(0,s.jsxs)("form",{onSubmit:z,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["影片名称 * ",s.jsx("span",{className:"text-red-500",children:"必填"})]}),s.jsx(n.I,{value:P.name,onChange:e=>Z("name",e.target.value),placeholder:"重生之你动我一下试试",required:!0})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL别名"}),s.jsx(n.I,{value:P.slug,onChange:e=>Z("slug",e.target.value),placeholder:"自动生成",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["主标题 * ",s.jsx("span",{className:"text-red-500",children:"必填"})]}),s.jsx(n.I,{value:P.mainTitle,onChange:e=>Z("mainTitle",e.target.value),placeholder:"重生之你动我一下试试",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["副标题 * ",s.jsx("span",{className:"text-red-500",children:"必填"})]}),s.jsx(n.I,{value:P.subTitle,onChange:e=>Z("subTitle",e.target.value),placeholder:"重生之你真敢动我?",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["分类 * ",s.jsx("span",{className:"text-red-500",children:"必填"})]}),(0,s.jsxs)("select",{value:P.categoryId,onChange:e=>Z("categoryId",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[s.jsx("option",{value:"",children:"请选择分类"}),g.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),0===g.length&&s.jsx("p",{className:"text-xs text-red-500 mt-1",children:"请先在分类管理中创建分类"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["9:16封面图 * ",s.jsx("span",{className:"text-red-500",children:"必填"})]}),(0,s.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:[P.coverImageId?(0,s.jsxs)("div",{className:"space-y-4",children:[s.jsx("div",{className:"relative w-32 h-48 bg-gray-100 rounded-lg overflow-hidden mx-auto",children:s.jsx("img",{src:P.coverImageId,alt:"封面预览",className:"w-full h-full object-cover"})}),(0,s.jsxs)("div",{className:"flex justify-center space-x-2",children:[s.jsx(l.z,{type:"button",variant:"outline",size:"sm",onClick:()=>k.current?.click(),disabled:y,children:"重新选择"}),s.jsx(l.z,{type:"button",variant:"outline",size:"sm",onClick:()=>C(e=>({...e,coverImageId:""})),children:"删除"})]})]}):(0,s.jsxs)("div",{className:"text-center",children:[s.jsx(m.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,s.jsxs)(l.z,{type:"button",onClick:()=>k.current?.click(),disabled:y,children:[s.jsx(x.Z,{className:"h-4 w-4 mr-2"}),y?"上传中...":"选择封面图"]}),s.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"9:16比例，推荐540x960像素"})]}),s.jsx("input",{ref:k,type:"file",accept:"image/*",onChange:e=>T(e,"cover"),className:"hidden"})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"16:9轮播图 (可选)"}),(0,s.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:[P.bannerUrl?(0,s.jsxs)("div",{className:"space-y-4",children:[s.jsx("div",{className:"relative w-full h-32 bg-gray-100 rounded-lg overflow-hidden",children:s.jsx("img",{src:P.bannerUrl,alt:"轮播图预览",className:"w-full h-full object-cover"})}),(0,s.jsxs)("div",{className:"flex justify-center space-x-2",children:[s.jsx(l.z,{type:"button",variant:"outline",size:"sm",onClick:()=>w.current?.click(),disabled:j,children:"重新选择"}),s.jsx(l.z,{type:"button",variant:"outline",size:"sm",onClick:()=>C(e=>({...e,bannerUrl:""})),children:"删除"})]})]}):(0,s.jsxs)("div",{className:"text-center",children:[s.jsx(m.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,s.jsxs)(l.z,{type:"button",variant:"outline",onClick:()=>w.current?.click(),disabled:j,children:[s.jsx(x.Z,{className:"h-4 w-4 mr-2"}),j?"上传中...":"选择轮播图"]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["16:9比例，推荐1920x1080像素",s.jsx("br",{}),"只有上传了轮播图的影片才能设置为轮播图"]})]}),s.jsx("input",{ref:w,type:"file",accept:"image/*",onChange:e=>T(e,"banner"),className:"hidden"})]})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"剧情简介"}),s.jsx(c.g,{value:P.synopsis,onChange:e=>Z("synopsis",e.target.value),placeholder:"输入影片的剧情简介...",rows:4})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"表单完成状态:"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs",children:[(0,s.jsxs)("div",{className:P.name.trim()?"text-green-600":"text-red-600",children:["影片名称: ",P.name.trim()?"✅":"❌"]}),(0,s.jsxs)("div",{className:P.mainTitle.trim()?"text-green-600":"text-red-600",children:["主标题: ",P.mainTitle.trim()?"✅":"❌"]}),(0,s.jsxs)("div",{className:P.subTitle.trim()?"text-green-600":"text-red-600",children:["副标题: ",P.subTitle.trim()?"✅":"❌"]}),(0,s.jsxs)("div",{className:P.coverImageId.trim()?"text-green-600":"text-red-600",children:["封面图: ",P.coverImageId.trim()?"✅":"❌"]}),(0,s.jsxs)("div",{className:P.categoryId?"text-green-600":"text-red-600",children:["分类: ",P.categoryId?"✅":"❌"]}),(0,s.jsxs)("div",{className:P.bannerUrl.trim()?"text-blue-600":"text-gray-500",children:["轮播图: ",P.bannerUrl.trim()?"✅ 可用于轮播":"无 (可选)"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)(l.z,{type:"submit",disabled:r||!P.name.trim()||!P.mainTitle.trim()||!P.subTitle.trim()||!P.coverImageId.trim()||!P.categoryId,children:[r&&s.jsx(u.Z,{className:"mr-2 h-4 w-4 animate-spin"}),s.jsx(p.Z,{className:"h-4 w-4 mr-2"}),"添加到影片库"]}),s.jsx(h(),{href:"/admin/content/movie-library",children:s.jsx(l.z,{variant:"outline",type:"button",children:"取消"})})]})]})})]})]})}},61351:(e,r,t)=>{"use strict";t.d(r,{Ol:()=>n,SZ:()=>c,Zb:()=>l,aY:()=>o,ll:()=>d});var s=t(95344),a=t(3729),i=t(91626);let l=a.forwardRef(({className:e,...r},t)=>s.jsx("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...r}));l.displayName="Card";let n=a.forwardRef(({className:e,...r},t)=>s.jsx("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",e),...r}));n.displayName="CardHeader";let d=a.forwardRef(({className:e,...r},t)=>s.jsx("h3",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",e),...r}));d.displayName="CardTitle";let c=a.forwardRef(({className:e,...r},t)=>s.jsx("p",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",e),...r}));c.displayName="CardDescription";let o=a.forwardRef(({className:e,...r},t)=>s.jsx("div",{ref:t,className:(0,i.cn)("p-6 pt-0",e),...r}));o.displayName="CardContent",a.forwardRef(({className:e,...r},t)=>s.jsx("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",e),...r})).displayName="CardFooter"},92549:(e,r,t)=>{"use strict";t.d(r,{I:()=>l});var s=t(95344),a=t(3729),i=t(91626);let l=a.forwardRef(({className:e,type:r,...t},a)=>s.jsx("input",{type:r,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...t}));l.displayName="Input"},93601:(e,r,t)=>{"use strict";t.d(r,{g:()=>l});var s=t(95344),a=t(3729),i=t(91626);let l=a.forwardRef(({className:e,...r},t)=>s.jsx("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:t,...r}));l.displayName="Textarea"},63024:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,t(69224).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},42739:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,t(69224).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},31498:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,t(69224).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},3380:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,t(69224).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},82933:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>l,__esModule:()=>i,default:()=>c,dynamic:()=>d});var s=t(86843);let a=(0,s.createProxy)(String.raw`/Users/mayingkun/mkwork/cursorproject/H5/DraminiCMS/app/admin/content/movie-library/create/page.tsx`),{__esModule:i,$$typeof:l}=a,n=a.default,d=(0,s.createProxy)(String.raw`/Users/mayingkun/mkwork/cursorproject/H5/DraminiCMS/app/admin/content/movie-library/create/page.tsx#dynamic`),c=n}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,412,2284,5724,8309],()=>t(31366));module.exports=s})();