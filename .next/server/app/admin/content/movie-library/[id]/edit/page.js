(()=>{var e={};e.id=6017,e.ids=[6017],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},73654:(e,r,s)=>{"use strict";s.r(r),s.d(r,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>x,tree:()=>c});var t=s(50482),a=s(69108),i=s(62563),l=s.n(i),n=s(68300),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);s.d(r,o);let c=["",{children:["admin",{children:["content",{children:["movie-library",{children:["[id]",{children:["edit",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,84360)),"/Users/mayingkun/mkwork/cursorproject/H5/DraminiCMS/app/admin/content/movie-library/[id]/edit/page.tsx"]}]},{}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,66294)),"/Users/mayingkun/mkwork/cursorproject/H5/DraminiCMS/app/admin/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,82917)),"/Users/mayingkun/mkwork/cursorproject/H5/DraminiCMS/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,69361,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/mayingkun/mkwork/cursorproject/H5/DraminiCMS/app/admin/content/movie-library/[id]/edit/page.tsx"],m="/admin/content/movie-library/[id]/edit/page",u={require:s,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/content/movie-library/[id]/edit/page",pathname:"/admin/content/movie-library/[id]/edit",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},29769:(e,r,s)=>{Promise.resolve().then(s.bind(s,918))},918:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>y,dynamic:()=>b});var t=s(95344),a=s(3729),i=s(22254),l=s(16212),n=s(92549),o=s(61351),c=s(93601),d=s(63024),m=s(20016),u=s(3380),x=s(42739),p=s(31498),g=s(20783),h=s.n(g),f=s(44669);let b="force-dynamic";function y({params:e}){let r=(0,i.useRouter)(),[s,g]=(0,a.useState)(!1),[b,y]=(0,a.useState)(!0),[v,j]=(0,a.useState)([]),[N,k]=(0,a.useState)(!1),[w,C]=(0,a.useState)(!1),P=(0,a.useRef)(null),Z=(0,a.useRef)(null),[U,S]=(0,a.useState)({name:"",mainTitle:"",subTitle:"",slug:"",synopsis:"",coverUrl:"",bannerUrl:"",categoryId:"",language:"zh",status:"DRAFT",isOnline:!1});(0,a.useEffect)(()=>{z(),T()},[]);let z=async()=>{try{let e=await fetch("/api/categories");if(e.ok){let r=await e.json();j(r)}}catch(e){console.error("Failed to fetch categories:",e)}},T=async()=>{try{let s=await fetch(`/api/movie-library/${e.id}`);if(s.ok){let e=await s.json();S({name:e.name,mainTitle:e.mainTitle||"",subTitle:e.subTitle||"",slug:e.slug,synopsis:e.synopsis||"",coverUrl:e.coverUrl||"",bannerUrl:e.bannerUrl||"",categoryId:e.categoryId||"",language:e.language,status:e.status,isOnline:e.isOnline})}else f.ZP.error("影片不存在"),r.push("/admin/content/movie-library")}catch(e){f.ZP.error("加载失败"),r.push("/admin/content/movie-library")}finally{y(!1)}},_=(e,r)=>{if(S(s=>({...s,[e]:r})),"name"===e&&"string"==typeof r&&r){let e=r.toLowerCase().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"");S(r=>({...r,slug:e}))}},R=async(e,r)=>{let s=e.target.files?.[0];if(!s)return;if(!s.type.startsWith("image/")){f.ZP.error("请选择图片文件");return}if(s.size>5242880){f.ZP.error("图片文件不能超过 5MB");return}let t="cover"===r?k:C;t(!0);try{let e=new FormData;e.append("file",s),e.append("type",r);let t=await fetch("/api/upload/movie-image",{method:"POST",body:e});if(t.ok){let e=await t.json();S(s=>({...s,["cover"===r?"coverUrl":"bannerUrl"]:e.url})),f.ZP.success(`${"cover"===r?"封面图":"轮播图"}上传成功`)}else f.ZP.error("图片上传失败")}catch(e){f.ZP.error("上传失败")}finally{t(!1)}},q=async s=>{if(s.preventDefault(),!U.name.trim()){f.ZP.error("请填写影片名称");return}g(!0);try{let s=await fetch(`/api/movie-library/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(U)});if(s.ok)f.ZP.success("影片更新成功"),r.push("/admin/content/movie-library");else{let e=await s.text();f.ZP.error("更新失败: "+e)}}catch(e){f.ZP.error("网络错误")}finally{g(!1)}};return b?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"text-lg",children:"加载中..."})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[t.jsx(h(),{href:"/admin/content/movie-library",children:(0,t.jsxs)(l.z,{variant:"outline",size:"sm",children:[t.jsx(d.Z,{className:"h-4 w-4 mr-2"}),"返回影片库"]})}),(0,t.jsxs)("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"编辑影片"}),t.jsx("p",{className:"text-gray-600",children:"修改影片信息"})]})]}),(0,t.jsxs)(o.Zb,{children:[t.jsx(o.Ol,{children:t.jsx(o.ll,{children:"影片信息"})}),t.jsx(o.aY,{children:(0,t.jsxs)("form",{onSubmit:q,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"影片名称 *"}),t.jsx(n.I,{value:U.name,onChange:e=>_("name",e.target.value),placeholder:"输入影片名称",required:!0})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL别名"}),t.jsx(n.I,{value:U.slug,onChange:e=>_("slug",e.target.value),placeholder:"自动生成",required:!0})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"主标题"}),t.jsx(n.I,{value:U.mainTitle,onChange:e=>_("mainTitle",e.target.value),placeholder:"主标题"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"副标题"}),t.jsx(n.I,{value:U.subTitle,onChange:e=>_("subTitle",e.target.value),placeholder:"副标题"})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"分类"}),(0,t.jsxs)("select",{value:U.categoryId,onChange:e=>_("categoryId",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"请选择分类"}),v.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"发布状态"}),(0,t.jsxs)("select",{value:U.status,onChange:e=>_("status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"DRAFT",children:"草稿"}),t.jsx("option",{value:"PUBLISHED",children:"已发布"})]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"上线状态"}),(0,t.jsxs)("select",{value:U.isOnline?"true":"false",onChange:e=>_("isOnline","true"===e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"false",children:"已下线"}),t.jsx("option",{value:"true",children:"已上线"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"9:16封面图"}),(0,t.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:[U.coverUrl?(0,t.jsxs)("div",{className:"space-y-4",children:[t.jsx("div",{className:"relative w-32 h-48 bg-gray-100 rounded-lg overflow-hidden mx-auto",children:t.jsx("img",{src:U.coverUrl,alt:"封面预览",className:"w-full h-full object-cover"})}),(0,t.jsxs)("div",{className:"flex justify-center space-x-2",children:[t.jsx(l.z,{type:"button",variant:"outline",size:"sm",onClick:()=>P.current?.click(),disabled:N,children:"重新选择"}),t.jsx(l.z,{type:"button",variant:"outline",size:"sm",onClick:()=>S(e=>({...e,coverUrl:""})),children:"删除图片"})]})]}):(0,t.jsxs)("div",{className:"text-center",children:[t.jsx(m.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,t.jsxs)(l.z,{type:"button",onClick:()=>P.current?.click(),disabled:N,children:[t.jsx(u.Z,{className:"h-4 w-4 mr-2"}),N?"上传中...":"选择封面图"]})]}),t.jsx("input",{ref:P,type:"file",accept:"image/*",onChange:e=>R(e,"cover"),className:"hidden"})]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"16:9轮播图 (可选)"}),(0,t.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:[U.bannerUrl?(0,t.jsxs)("div",{className:"space-y-4",children:[t.jsx("div",{className:"relative w-full h-32 bg-gray-100 rounded-lg overflow-hidden",children:t.jsx("img",{src:U.bannerUrl,alt:"轮播图预览",className:"w-full h-full object-cover"})}),(0,t.jsxs)("div",{className:"flex justify-center space-x-2",children:[t.jsx(l.z,{type:"button",variant:"outline",size:"sm",onClick:()=>Z.current?.click(),disabled:w,children:"重新选择"}),t.jsx(l.z,{type:"button",variant:"outline",size:"sm",onClick:()=>S(e=>({...e,bannerUrl:""})),children:"删除图片"})]})]}):(0,t.jsxs)("div",{className:"text-center",children:[t.jsx(m.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,t.jsxs)(l.z,{type:"button",variant:"outline",onClick:()=>Z.current?.click(),disabled:w,children:[t.jsx(u.Z,{className:"h-4 w-4 mr-2"}),w?"上传中...":"选择轮播图"]})]}),t.jsx("input",{ref:Z,type:"file",accept:"image/*",onChange:e=>R(e,"banner"),className:"hidden"})]})]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"剧情简介"}),t.jsx(c.g,{value:U.synopsis,onChange:e=>_("synopsis",e.target.value),placeholder:"输入影片的剧情简介...",rows:4})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)(l.z,{type:"submit",disabled:s,children:[s&&t.jsx(x.Z,{className:"mr-2 h-4 w-4 animate-spin"}),t.jsx(p.Z,{className:"h-4 w-4 mr-2"}),"保存修改"]}),t.jsx(h(),{href:"/admin/content/movie-library",children:t.jsx(l.z,{variant:"outline",type:"button",children:"取消"})})]})]})})]})]})}},61351:(e,r,s)=>{"use strict";s.d(r,{Ol:()=>n,SZ:()=>c,Zb:()=>l,aY:()=>d,ll:()=>o});var t=s(95344),a=s(3729),i=s(91626);let l=a.forwardRef(({className:e,...r},s)=>t.jsx("div",{ref:s,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...r}));l.displayName="Card";let n=a.forwardRef(({className:e,...r},s)=>t.jsx("div",{ref:s,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",e),...r}));n.displayName="CardHeader";let o=a.forwardRef(({className:e,...r},s)=>t.jsx("h3",{ref:s,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",e),...r}));o.displayName="CardTitle";let c=a.forwardRef(({className:e,...r},s)=>t.jsx("p",{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",e),...r}));c.displayName="CardDescription";let d=a.forwardRef(({className:e,...r},s)=>t.jsx("div",{ref:s,className:(0,i.cn)("p-6 pt-0",e),...r}));d.displayName="CardContent",a.forwardRef(({className:e,...r},s)=>t.jsx("div",{ref:s,className:(0,i.cn)("flex items-center p-6 pt-0",e),...r})).displayName="CardFooter"},92549:(e,r,s)=>{"use strict";s.d(r,{I:()=>l});var t=s(95344),a=s(3729),i=s(91626);let l=a.forwardRef(({className:e,type:r,...s},a)=>t.jsx("input",{type:r,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...s}));l.displayName="Input"},93601:(e,r,s)=>{"use strict";s.d(r,{g:()=>l});var t=s(95344),a=s(3729),i=s(91626);let l=a.forwardRef(({className:e,...r},s)=>t.jsx("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...r}));l.displayName="Textarea"},63024:(e,r,s)=>{"use strict";s.d(r,{Z:()=>t});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,s(69224).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},42739:(e,r,s)=>{"use strict";s.d(r,{Z:()=>t});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,s(69224).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},84360:(e,r,s)=>{"use strict";s.r(r),s.d(r,{$$typeof:()=>l,__esModule:()=>i,default:()=>c,dynamic:()=>o});var t=s(86843);let a=(0,t.createProxy)(String.raw`/Users/mayingkun/mkwork/cursorproject/H5/DraminiCMS/app/admin/content/movie-library/[id]/edit/page.tsx`),{__esModule:i,$$typeof:l}=a,n=a.default,o=(0,t.createProxy)(String.raw`/Users/mayingkun/mkwork/cursorproject/H5/DraminiCMS/app/admin/content/movie-library/[id]/edit/page.tsx#dynamic`),c=n}};var r=require("../../../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[1638,312,733,5724,2146,600],()=>s(73654));module.exports=t})();