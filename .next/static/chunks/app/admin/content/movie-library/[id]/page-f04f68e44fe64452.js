(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[305],{5177:function(e,s,r){Promise.resolve().then(r.bind(r,3813))},3813:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return R},dynamic:function(){return S}});var t=r(7437),a=r(2265),i=r(4033),n=r(5754),l=r(5179),c=r(7815),d=r(1478),o=r(4522),m=r(1657);let u=o.fC,x=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)(o.aV,{ref:s,className:(0,m.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...a})});x.displayName=o.aV.displayName;let f=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)(o.xz,{ref:s,className:(0,m.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...a})});f.displayName=o.xz.displayName;let h=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)(o.VY,{ref:s,className:(0,m.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...a})});h.displayName=o.VY.displayName;var p=r(3067),g=r(9617),j=r(9883),v=r(4900),b=r(6141),N=r(7216),y=r(9670),w=r(1138),C=r(1396),k=r.n(C),P=r(6691),Z=r.n(P),z=r(5925);let S="force-dynamic";function R(){let e=(0,i.useParams)();(0,i.useRouter)();let s=e.id,[r,o]=(0,a.useState)(null),[m,C]=(0,a.useState)([]),[P,S]=(0,a.useState)(!0),[R,U]=(0,a.useState)("info"),[E,I]=(0,a.useState)(!1),[O,T]=(0,a.useState)(null),[F,L]=(0,a.useState)({episodeNum:1,name:"",description:"",videoUrl:"",duration:"",thumbnail:""});(0,a.useEffect)(()=>{V(),Y()},[s]);let V=async()=>{try{let e=await fetch("/api/movie-library/".concat(s)),r=await e.json();o(r)}catch(e){z.ZP.error("获取剧目详情失败")}},Y=async()=>{try{let e=await fetch("/api/episodes?titleId=".concat(s)),r=await e.json();C(r.sort((e,s)=>e.episodeNum-s.episodeNum))}catch(e){z.ZP.error("获取剧集列表失败")}finally{S(!1)}},_=async()=>{if(!F.videoUrl){z.ZP.error("请填写视频地址");return}try{if((await fetch("/api/episodes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({titleId:s,...F,duration:F.duration?parseInt(F.duration):null})})).ok)z.ZP.success("剧集创建成功"),I(!1),J(),Y();else throw Error("创建失败")}catch(e){z.ZP.error("创建剧集失败")}},H=async()=>{if(!O||!F.videoUrl){z.ZP.error("请填写必要信息");return}try{if((await fetch("/api/episodes/".concat(O.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({...F,duration:F.duration?parseInt(F.duration):null})})).ok)z.ZP.success("剧集更新成功"),I(!1),T(null),J(),Y();else throw Error("更新失败")}catch(e){z.ZP.error("更新剧集失败")}},D=async e=>{if(confirm("确定要删除这个剧集吗？"))try{if((await fetch("/api/episodes/".concat(e),{method:"DELETE"})).ok)z.ZP.success("剧集删除成功"),Y();else throw Error("删除失败")}catch(e){z.ZP.error("删除剧集失败")}},A=async(e,s)=>{try{if((await fetch("/api/episodes/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isFreePreview:!s})})).ok)z.ZP.success("剧集已".concat(s?"下线":"上线")),Y();else throw Error("更新失败")}catch(e){z.ZP.error("更新剧集状态失败")}},B=e=>{if(e){var s;T(e),L({episodeNum:e.episodeNum,name:e.name||"",description:e.description||"",videoUrl:e.videoUrl,duration:(null===(s=e.duration)||void 0===s?void 0:s.toString())||"",thumbnail:e.thumbnail||""})}else T(null),L({episodeNum:m.length>0?Math.max(...m.map(e=>e.episodeNum))+1:1,name:"",description:"",videoUrl:"",duration:"",thumbnail:""});I(!0)},J=()=>{L({episodeNum:1,name:"",description:"",videoUrl:"",duration:"",thumbnail:""})},M=e=>e?"".concat(Math.floor(e/60),":").concat((e%60).toString().padStart(2,"0")):"--";return P?(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"text-lg",children:"加载中..."})})}):r?(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(k(),{href:"/admin/content/movie-library",children:(0,t.jsxs)(n.z,{variant:"ghost",size:"sm",children:[(0,t.jsx)(p.Z,{className:"w-4 h-4 mr-2"}),"返回影片库"]})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:r.name}),(0,t.jsx)("p",{className:"text-gray-600",children:r.mainTitle||r.subTitle})]})]}),(0,t.jsxs)(u,{value:R,onValueChange:U,children:[(0,t.jsxs)(x,{children:[(0,t.jsx)(f,{value:"info",children:"剧目信息"}),(0,t.jsx)(f,{value:"episodes",children:"剧集管理"})]}),(0,t.jsx)(h,{value:"info",className:"space-y-6",children:(0,t.jsxs)(c.Zb,{children:[(0,t.jsx)(c.Ol,{children:(0,t.jsxs)(c.ll,{className:"flex items-center justify-between",children:["剧目详情",(0,t.jsx)(k(),{href:"/admin/content/movie-library/".concat(r.id,"/edit"),children:(0,t.jsxs)(n.z,{size:"sm",children:[(0,t.jsx)(g.Z,{className:"w-4 h-4 mr-2"}),"编辑剧目"]})})]})}),(0,t.jsx)(c.aY,{children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{children:(0,t.jsx)(Z(),{src:r.coverUrl,alt:r.name,width:200,height:300,className:"rounded-lg shadow-md"})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.C,{variant:r.isOnline?"default":"secondary",children:r.isOnline?"已上线":"已下线"}),(0,t.jsx)(d.C,{variant:"outline",children:"PUBLISHED"===r.status?"已发布":"草稿"}),r.category&&(0,t.jsx)(d.C,{variant:"outline",children:r.category.name})]})]}),(0,t.jsxs)("div",{className:"md:col-span-2 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"基本信息"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"剧目名称:"}),(0,t.jsx)("p",{className:"font-medium",children:r.name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"主标题:"}),(0,t.jsx)("p",{className:"font-medium",children:r.mainTitle||"--"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"副标题:"}),(0,t.jsx)("p",{className:"font-medium",children:r.subTitle||"--"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"评分:"}),(0,t.jsx)("p",{className:"font-medium",children:r.rating||"--"})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"URL别名:"}),(0,t.jsx)("p",{className:"font-medium",children:r.slug})]})]})]}),r.synopsis&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"剧情简介"}),(0,t.jsx)("p",{className:"text-gray-700 leading-relaxed",children:r.synopsis})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"统计信息"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[(0,t.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:m.length}),(0,t.jsx)("p",{className:"text-gray-600",children:"总集数"})]}),(0,t.jsxs)("div",{className:"bg-green-50 p-3 rounded-lg text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-green-600",children:m.filter(e=>e.isFreePreview).length}),(0,t.jsx)("p",{className:"text-gray-600",children:"已上线"})]}),(0,t.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg text-center",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-600",children:m.filter(e=>!e.isFreePreview).length}),(0,t.jsx)("p",{className:"text-gray-600",children:"已下线"})]})]})]})]})]})})]})}),(0,t.jsx)(h,{value:"episodes",className:"space-y-6",children:(0,t.jsxs)(c.Zb,{children:[(0,t.jsx)(c.Ol,{children:(0,t.jsxs)(c.ll,{className:"flex items-center justify-between",children:["剧集管理",(0,t.jsxs)(n.z,{onClick:()=>B(),children:[(0,t.jsx)(j.Z,{className:"w-4 h-4 mr-2"}),"添加剧集"]})]})}),(0,t.jsx)(c.aY,{children:0===m.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(v.Z,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),(0,t.jsx)("p",{className:"text-gray-500 mb-4",children:"该剧目暂无剧集"}),(0,t.jsxs)(n.z,{onClick:()=>B(),children:[(0,t.jsx)(j.Z,{className:"w-4 h-4 mr-2"}),"添加第一集"]})]}):(0,t.jsx)("div",{className:"space-y-4",children:m.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center font-bold text-blue-600",children:e.episodeNum}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("h3",{className:"font-medium",children:["第",e.episodeNum,"集",e.name&&" - ".concat(e.name)]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500 mt-1",children:[(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(b.Z,{className:"w-3 h-3"}),M(e.duration)]}),(0,t.jsx)(d.C,{variant:e.isFreePreview?"default":"secondary",className:"text-xs",children:e.isFreePreview?"已上线":"已下线"}),(0,t.jsx)(d.C,{variant:"outline",className:"text-xs",children:"PUBLISHED"===e.status?"已发布":"草稿"})]}),e.description&&(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:e.description})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n.z,{variant:e.isFreePreview?"outline":"default",size:"sm",onClick:()=>A(e.id,e.isFreePreview),children:e.isFreePreview?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(N.Z,{className:"w-3 h-3 mr-1"}),"下线"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.Z,{className:"w-3 h-3 mr-1"}),"上线"]})}),(0,t.jsxs)(n.z,{variant:"ghost",size:"sm",onClick:()=>B(e),children:[(0,t.jsx)(g.Z,{className:"w-3 h-3 mr-1"}),"编辑"]}),(0,t.jsxs)(n.z,{variant:"ghost",size:"sm",onClick:()=>D(e.id),className:"text-red-600 hover:text-red-700",children:[(0,t.jsx)(w.Z,{className:"w-3 h-3 mr-1"}),"删除"]})]})]},e.id))})})]})})]}),E&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)(c.Zb,{className:"w-full max-w-lg mx-4",children:[(0,t.jsx)(c.Ol,{children:(0,t.jsx)(c.ll,{children:O?"编辑剧集":"添加剧集"})}),(0,t.jsxs)(c.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"集数编号 *"}),(0,t.jsx)(l.I,{type:"number",min:"1",value:F.episodeNum,onChange:e=>L(s=>({...s,episodeNum:parseInt(e.target.value)||1}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"集数名称"}),(0,t.jsx)(l.I,{placeholder:"例如：初次相遇",value:F.name,onChange:e=>L(s=>({...s,name:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"视频地址 *"}),(0,t.jsx)(l.I,{placeholder:"视频文件URL或播放页面URL",value:F.videoUrl,onChange:e=>L(s=>({...s,videoUrl:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"时长（秒）"}),(0,t.jsx)(l.I,{type:"number",placeholder:"例如：3600",value:F.duration,onChange:e=>L(s=>({...s,duration:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"缩略图URL"}),(0,t.jsx)(l.I,{placeholder:"剧集缩略图地址",value:F.thumbnail,onChange:e=>L(s=>({...s,thumbnail:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"剧集描述"}),(0,t.jsx)("textarea",{className:"w-full p-2 border rounded-md resize-none",rows:3,placeholder:"剧集简介...",value:F.description,onChange:e=>L(s=>({...s,description:e.target.value}))})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.z,{onClick:O?H:_,className:"flex-1",children:O?"更新剧集":"创建剧集"}),(0,t.jsx)(n.z,{variant:"outline",onClick:()=>{I(!1),T(null),J()},className:"flex-1",children:"取消"})]})]})]})})]}):(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"text-lg text-red-600",children:"剧目不存在"})})})}},1478:function(e,s,r){"use strict";r.d(s,{C:function(){return l}});var t=r(7437);r(2265);var a=r(6061),i=r(1657);let n=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:s,variant:r,...a}=e;return(0,t.jsx)("div",{className:(0,i.cn)(n({variant:r}),s),...a})}},5754:function(e,s,r){"use strict";r.d(s,{z:function(){return d}});var t=r(7437),a=r(2265),i=r(7256),n=r(6061),l=r(1657);let c=(0,n.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,s)=>{let{className:r,variant:a,size:n,asChild:d=!1,...o}=e,m=d?i.g7:"button";return(0,t.jsx)(m,{className:(0,l.cn)(c({variant:a,size:n,className:r})),ref:s,...o})});d.displayName="Button"},7815:function(e,s,r){"use strict";r.d(s,{Ol:function(){return l},SZ:function(){return d},Zb:function(){return n},aY:function(){return o},ll:function(){return c}});var t=r(7437),a=r(2265),i=r(1657);let n=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});n.displayName="Card";let l=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r),...a})});l.displayName="CardHeader";let c=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("h3",{ref:s,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});c.displayName="CardTitle";let d=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("p",{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",r),...a})});d.displayName="CardDescription";let o=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,i.cn)("p-6 pt-0",r),...a})});o.displayName="CardContent",a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,i.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},5179:function(e,s,r){"use strict";r.d(s,{I:function(){return n}});var t=r(7437),a=r(2265),i=r(1657);let n=a.forwardRef((e,s)=>{let{className:r,type:a,...n}=e;return(0,t.jsx)("input",{type:a,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:s,...n})});n.displayName="Input"},1657:function(e,s,r){"use strict";r.d(s,{cn:function(){return i}});var t=r(7042),a=r(4769);function i(){for(var e=arguments.length,s=Array(e),r=0;r<e;r++)s[r]=arguments[r];return(0,a.m6)((0,t.W)(s))}}},function(e){e.O(0,[61,465,396,356,800,971,938,744],function(){return e(e.s=5177)}),_N_E=e.O()}]);