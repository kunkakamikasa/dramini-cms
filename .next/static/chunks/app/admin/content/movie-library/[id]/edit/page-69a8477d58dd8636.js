(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[17],{3067:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(2898).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},8438:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(2898).Z)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},6264:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(2898).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},6245:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(2898).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},1541:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(2898).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},1672:function(e,r,t){Promise.resolve().then(t.bind(t,4364))},4364:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return p},dynamic:function(){return b}});var n=t(7437),s=t(2265),a=t(4033),l=t(5754),i=t(5179),o=t(7815),c=t(3444),d=t(3067),u=t(8438),m=t(1541),f=t(6264),x=t(6245),h=t(1396),g=t.n(h),v=t(5925);let b="force-dynamic";function p(e){let{params:r}=e,t=(0,a.useRouter)(),[h,b]=(0,s.useState)(!1),[p,y]=(0,s.useState)(!0),[j,N]=(0,s.useState)([]),[w,k]=(0,s.useState)(!1),[Z,C]=(0,s.useState)(!1),z=(0,s.useRef)(null),U=(0,s.useRef)(null),[T,P]=(0,s.useState)({name:"",mainTitle:"",subTitle:"",slug:"",synopsis:"",coverUrl:"",bannerUrl:"",categoryId:"",language:"zh",status:"DRAFT",isOnline:!1});(0,s.useEffect)(()=>{R(),I()},[]);let R=async()=>{try{let e=await fetch("/api/categories");if(e.ok){let r=await e.json();N(r)}}catch(e){console.error("Failed to fetch categories:",e)}},I=async()=>{try{let e=await fetch("/api/movie-library/".concat(r.id));if(e.ok){let r=await e.json();P({name:r.name,mainTitle:r.mainTitle||"",subTitle:r.subTitle||"",slug:r.slug,synopsis:r.synopsis||"",coverUrl:r.coverUrl||"",bannerUrl:r.bannerUrl||"",categoryId:r.categoryId||"",language:r.language,status:r.status,isOnline:r.isOnline})}else v.ZP.error("影片不存在"),t.push("/admin/content/movie-library")}catch(e){v.ZP.error("加载失败"),t.push("/admin/content/movie-library")}finally{y(!1)}},S=(e,r)=>{if(P(t=>({...t,[e]:r})),"name"===e&&"string"==typeof r&&r){let e=r.toLowerCase().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"");P(r=>({...r,slug:e}))}},O=async(e,r)=>{var t;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!n)return;if(!n.type.startsWith("image/")){v.ZP.error("请选择图片文件");return}if(n.size>5242880){v.ZP.error("图片文件不能超过 5MB");return}let s="cover"===r?k:C;s(!0);try{let e=new FormData;e.append("file",n),e.append("type",r);let t=await fetch("/api/upload/movie-image",{method:"POST",body:e});if(t.ok){let e=await t.json();P(t=>({...t,["cover"===r?"coverUrl":"bannerUrl"]:e.url})),v.ZP.success("".concat("cover"===r?"封面图":"轮播图","上传成功"))}else v.ZP.error("图片上传失败")}catch(e){v.ZP.error("上传失败")}finally{s(!1)}},_=async e=>{if(e.preventDefault(),!T.name.trim()){v.ZP.error("请填写影片名称");return}b(!0);try{let e=await fetch("/api/movie-library/".concat(r.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)});if(e.ok)v.ZP.success("影片更新成功"),t.push("/admin/content/movie-library");else{let r=await e.text();v.ZP.error("更新失败: "+r)}}catch(e){v.ZP.error("网络错误")}finally{b(!1)}};return p?(0,n.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,n.jsx)("div",{className:"text-lg",children:"加载中..."})}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(g(),{href:"/admin/content/movie-library",children:(0,n.jsxs)(l.z,{variant:"outline",size:"sm",children:[(0,n.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"返回影片库"]})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"编辑影片"}),(0,n.jsx)("p",{className:"text-gray-600",children:"修改影片信息"})]})]}),(0,n.jsxs)(o.Zb,{children:[(0,n.jsx)(o.Ol,{children:(0,n.jsx)(o.ll,{children:"影片信息"})}),(0,n.jsx)(o.aY,{children:(0,n.jsxs)("form",{onSubmit:_,className:"space-y-6",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"影片名称 *"}),(0,n.jsx)(i.I,{value:T.name,onChange:e=>S("name",e.target.value),placeholder:"输入影片名称",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL别名"}),(0,n.jsx)(i.I,{value:T.slug,onChange:e=>S("slug",e.target.value),placeholder:"自动生成",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"主标题"}),(0,n.jsx)(i.I,{value:T.mainTitle,onChange:e=>S("mainTitle",e.target.value),placeholder:"主标题"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"副标题"}),(0,n.jsx)(i.I,{value:T.subTitle,onChange:e=>S("subTitle",e.target.value),placeholder:"副标题"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"分类"}),(0,n.jsxs)("select",{value:T.categoryId,onChange:e=>S("categoryId",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,n.jsx)("option",{value:"",children:"请选择分类"}),j.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"发布状态"}),(0,n.jsxs)("select",{value:T.status,onChange:e=>S("status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,n.jsx)("option",{value:"DRAFT",children:"草稿"}),(0,n.jsx)("option",{value:"PUBLISHED",children:"已发布"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"上线状态"}),(0,n.jsxs)("select",{value:T.isOnline?"true":"false",onChange:e=>S("isOnline","true"===e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,n.jsx)("option",{value:"false",children:"已下线"}),(0,n.jsx)("option",{value:"true",children:"已上线"})]})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"9:16封面图"}),(0,n.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:[T.coverUrl?(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"relative w-32 h-48 bg-gray-100 rounded-lg overflow-hidden mx-auto",children:(0,n.jsx)("img",{src:T.coverUrl,alt:"封面预览",className:"w-full h-full object-cover"})}),(0,n.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,n.jsx)(l.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{var e;return null===(e=z.current)||void 0===e?void 0:e.click()},disabled:w,children:"重新选择"}),(0,n.jsx)(l.z,{type:"button",variant:"outline",size:"sm",onClick:()=>P(e=>({...e,coverUrl:""})),children:"删除图片"})]})]}):(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(u.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,n.jsxs)(l.z,{type:"button",onClick:()=>{var e;return null===(e=z.current)||void 0===e?void 0:e.click()},disabled:w,children:[(0,n.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),w?"上传中...":"选择封面图"]})]}),(0,n.jsx)("input",{ref:z,type:"file",accept:"image/*",onChange:e=>O(e,"cover"),className:"hidden"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"16:9轮播图 (可选)"}),(0,n.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:[T.bannerUrl?(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"relative w-full h-32 bg-gray-100 rounded-lg overflow-hidden",children:(0,n.jsx)("img",{src:T.bannerUrl,alt:"轮播图预览",className:"w-full h-full object-cover"})}),(0,n.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,n.jsx)(l.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{var e;return null===(e=U.current)||void 0===e?void 0:e.click()},disabled:Z,children:"重新选择"}),(0,n.jsx)(l.z,{type:"button",variant:"outline",size:"sm",onClick:()=>P(e=>({...e,bannerUrl:""})),children:"删除图片"})]})]}):(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(u.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,n.jsxs)(l.z,{type:"button",variant:"outline",onClick:()=>{var e;return null===(e=U.current)||void 0===e?void 0:e.click()},disabled:Z,children:[(0,n.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),Z?"上传中...":"选择轮播图"]})]}),(0,n.jsx)("input",{ref:U,type:"file",accept:"image/*",onChange:e=>O(e,"banner"),className:"hidden"})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"剧情简介"}),(0,n.jsx)(c.g,{value:T.synopsis,onChange:e=>S("synopsis",e.target.value),placeholder:"输入影片的剧情简介...",rows:4})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsxs)(l.z,{type:"submit",disabled:h,children:[h&&(0,n.jsx)(f.Z,{className:"mr-2 h-4 w-4 animate-spin"}),(0,n.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"保存修改"]}),(0,n.jsx)(g(),{href:"/admin/content/movie-library",children:(0,n.jsx)(l.z,{variant:"outline",type:"button",children:"取消"})})]})]})})]})]})}},5754:function(e,r,t){"use strict";t.d(r,{z:function(){return c}});var n=t(7437),s=t(2265),a=t(7256),l=t(6061),i=t(1657);let o=(0,l.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,r)=>{let{className:t,variant:s,size:l,asChild:c=!1,...d}=e,u=c?a.g7:"button";return(0,n.jsx)(u,{className:(0,i.cn)(o({variant:s,size:l,className:t})),ref:r,...d})});c.displayName="Button"},7815:function(e,r,t){"use strict";t.d(r,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return l},aY:function(){return d},ll:function(){return o}});var n=t(7437),s=t(2265),a=t(1657);let l=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("div",{ref:r,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s})});l.displayName="Card";let i=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("div",{ref:r,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",t),...s})});i.displayName="CardHeader";let o=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("h3",{ref:r,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",t),...s})});o.displayName="CardTitle";let c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("p",{ref:r,className:(0,a.cn)("text-sm text-muted-foreground",t),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("div",{ref:r,className:(0,a.cn)("p-6 pt-0",t),...s})});d.displayName="CardContent",s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("div",{ref:r,className:(0,a.cn)("flex items-center p-6 pt-0",t),...s})}).displayName="CardFooter"},5179:function(e,r,t){"use strict";t.d(r,{I:function(){return l}});var n=t(7437),s=t(2265),a=t(1657);let l=s.forwardRef((e,r)=>{let{className:t,type:s,...l}=e;return(0,n.jsx)("input",{type:s,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...l})});l.displayName="Input"},3444:function(e,r,t){"use strict";t.d(r,{g:function(){return l}});var n=t(7437),s=t(2265),a=t(1657);let l=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("textarea",{className:(0,a.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...s})});l.displayName="Textarea"},1657:function(e,r,t){"use strict";t.d(r,{cn:function(){return a}});var n=t(7042),s=t(4769);function a(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.m6)((0,n.W)(r))}},4033:function(e,r,t){e.exports=t(5313)}},function(e){e.O(0,[61,465,396,971,938,744],function(){return e(e.s=1672)}),_N_E=e.O()}]);