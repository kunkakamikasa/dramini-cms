(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[203],{3067:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,t(2898).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},8438:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,t(2898).Z)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},6264:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,t(2898).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},6245:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,t(2898).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},1541:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,t(2898).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},3451:function(e,r,t){Promise.resolve().then(t.bind(t,8241))},8241:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return p},dynamic:function(){return b}});var s=t(7437),n=t(2265),a=t(4033),i=t(5754),l=t(5179),c=t(7815),d=t(3444),o=t(3067),u=t(8438),m=t(1541),x=t(6264),f=t(6245),h=t(1396),g=t.n(h),v=t(5925);let b="force-dynamic";function p(){let e=(0,a.useRouter)(),[r,t]=(0,n.useState)(!1),[h,b]=(0,n.useState)([]),[p,y]=(0,n.useState)(!1),[j,N]=(0,n.useState)(!1),w=(0,n.useRef)(null),k=(0,n.useRef)(null),[Z,C]=(0,n.useState)({name:"",mainTitle:"",subTitle:"",slug:"",synopsis:"",coverUrl:"",bannerUrl:"",categoryId:"",language:"zh",status:"DRAFT",isOnline:!1});(0,n.useEffect)(()=>{z()},[]);let z=async()=>{try{let e=await fetch("/api/categories");if(e.ok){let r=await e.json();b(r)}}catch(e){console.error("Failed to fetch categories:",e)}},T=(e,r)=>{if(C(t=>({...t,[e]:r})),"name"===e&&r){let e=r.toLowerCase().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"");C(r=>({...r,slug:e}))}},U=async(e,r)=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!s)return;if(!s.type.startsWith("image/")){v.ZP.error("请选择图片文件");return}if(s.size>5242880){v.ZP.error("图片文件不能超过 5MB");return}let n="cover"===r?y:N;n(!0);try{let e=new FormData;e.append("file",s),e.append("type",r);let t=await fetch("/api/upload/movie-image",{method:"POST",body:e});if(t.ok){let e=await t.json();C(t=>({...t,["cover"===r?"coverUrl":"bannerUrl"]:e.url})),v.ZP.success("".concat("cover"===r?"封面图":"轮播图","上传成功"))}else v.ZP.error("图片上传失败")}catch(e){v.ZP.error("上传失败")}finally{n(!1)}},P=async r=>{if(r.preventDefault(),!Z.name.trim()){v.ZP.error("请填写影片名称");return}if(!Z.mainTitle.trim()){v.ZP.error("请填写主标题");return}if(!Z.subTitle.trim()){v.ZP.error("请填写副标题");return}if(!Z.coverUrl.trim()){v.ZP.error("请上传9:16封面图");return}if(!Z.categoryId){v.ZP.error("请选择分类");return}t(!0);try{let r=await fetch("/api/movie-library",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Z)});if(r.ok)v.ZP.success("影片添加成功"),e.push("/admin/content/movie-library");else{let e=await r.text();v.ZP.error("创建失败: "+e)}}catch(e){v.ZP.error("网络错误")}finally{t(!1)}};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(g(),{href:"/admin/content/movie-library",children:(0,s.jsxs)(i.z,{variant:"outline",size:"sm",children:[(0,s.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"返回影片库"]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"添加影片"}),(0,s.jsx)("p",{className:"text-gray-600",children:"添加新影片到影片库"})]})]}),(0,s.jsxs)(c.Zb,{children:[(0,s.jsx)(c.Ol,{children:(0,s.jsx)(c.ll,{children:"影片信息"})}),(0,s.jsx)(c.aY,{children:(0,s.jsxs)("form",{onSubmit:P,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["影片名称 * ",(0,s.jsx)("span",{className:"text-red-500",children:"必填"})]}),(0,s.jsx)(l.I,{value:Z.name,onChange:e=>T("name",e.target.value),placeholder:"重生之你动我一下试试",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL别名"}),(0,s.jsx)(l.I,{value:Z.slug,onChange:e=>T("slug",e.target.value),placeholder:"自动生成",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["主标题 * ",(0,s.jsx)("span",{className:"text-red-500",children:"必填"})]}),(0,s.jsx)(l.I,{value:Z.mainTitle,onChange:e=>T("mainTitle",e.target.value),placeholder:"重生之你动我一下试试",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["副标题 * ",(0,s.jsx)("span",{className:"text-red-500",children:"必填"})]}),(0,s.jsx)(l.I,{value:Z.subTitle,onChange:e=>T("subTitle",e.target.value),placeholder:"重生之你真敢动我?",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["分类 * ",(0,s.jsx)("span",{className:"text-red-500",children:"必填"})]}),(0,s.jsxs)("select",{value:Z.categoryId,onChange:e=>T("categoryId",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,s.jsx)("option",{value:"",children:"请选择分类"}),h.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]}),0===h.length&&(0,s.jsx)("p",{className:"text-xs text-red-500 mt-1",children:"请先在分类管理中创建分类"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["9:16封面图 * ",(0,s.jsx)("span",{className:"text-red-500",children:"必填"})]}),(0,s.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:[Z.coverUrl?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"relative w-32 h-48 bg-gray-100 rounded-lg overflow-hidden mx-auto",children:(0,s.jsx)("img",{src:Z.coverUrl,alt:"封面预览",className:"w-full h-full object-cover"})}),(0,s.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,s.jsx)(i.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{var e;return null===(e=w.current)||void 0===e?void 0:e.click()},disabled:p,children:"重新选择"}),(0,s.jsx)(i.z,{type:"button",variant:"outline",size:"sm",onClick:()=>C(e=>({...e,coverUrl:""})),children:"删除"})]})]}):(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(u.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,s.jsxs)(i.z,{type:"button",onClick:()=>{var e;return null===(e=w.current)||void 0===e?void 0:e.click()},disabled:p,children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),p?"上传中...":"选择封面图"]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"9:16比例，推荐540x960像素"})]}),(0,s.jsx)("input",{ref:w,type:"file",accept:"image/*",onChange:e=>U(e,"cover"),className:"hidden"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"16:9轮播图 (可选)"}),(0,s.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:[Z.bannerUrl?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"relative w-full h-32 bg-gray-100 rounded-lg overflow-hidden",children:(0,s.jsx)("img",{src:Z.bannerUrl,alt:"轮播图预览",className:"w-full h-full object-cover"})}),(0,s.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,s.jsx)(i.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{var e;return null===(e=k.current)||void 0===e?void 0:e.click()},disabled:j,children:"重新选择"}),(0,s.jsx)(i.z,{type:"button",variant:"outline",size:"sm",onClick:()=>C(e=>({...e,bannerUrl:""})),children:"删除"})]})]}):(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(u.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,s.jsxs)(i.z,{type:"button",variant:"outline",onClick:()=>{var e;return null===(e=k.current)||void 0===e?void 0:e.click()},disabled:j,children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),j?"上传中...":"选择轮播图"]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["16:9比例，推荐1920x1080像素",(0,s.jsx)("br",{}),"只有上传了轮播图的影片才能设置为轮播图"]})]}),(0,s.jsx)("input",{ref:k,type:"file",accept:"image/*",onChange:e=>U(e,"banner"),className:"hidden"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"剧情简介"}),(0,s.jsx)(d.g,{value:Z.synopsis,onChange:e=>T("synopsis",e.target.value),placeholder:"输入影片的剧情简介...",rows:4})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"表单完成状态:"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs",children:[(0,s.jsxs)("div",{className:Z.name.trim()?"text-green-600":"text-red-600",children:["影片名称: ",Z.name.trim()?"✅":"❌"]}),(0,s.jsxs)("div",{className:Z.mainTitle.trim()?"text-green-600":"text-red-600",children:["主标题: ",Z.mainTitle.trim()?"✅":"❌"]}),(0,s.jsxs)("div",{className:Z.subTitle.trim()?"text-green-600":"text-red-600",children:["副标题: ",Z.subTitle.trim()?"✅":"❌"]}),(0,s.jsxs)("div",{className:Z.coverUrl.trim()?"text-green-600":"text-red-600",children:["封面图: ",Z.coverUrl.trim()?"✅":"❌"]}),(0,s.jsxs)("div",{className:Z.categoryId?"text-green-600":"text-red-600",children:["分类: ",Z.categoryId?"✅":"❌"]}),(0,s.jsxs)("div",{className:Z.bannerUrl.trim()?"text-blue-600":"text-gray-500",children:["轮播图: ",Z.bannerUrl.trim()?"✅ 可用于轮播":"无 (可选)"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)(i.z,{type:"submit",disabled:r||!Z.name.trim()||!Z.mainTitle.trim()||!Z.subTitle.trim()||!Z.coverUrl.trim()||!Z.categoryId,children:[r&&(0,s.jsx)(x.Z,{className:"mr-2 h-4 w-4 animate-spin"}),(0,s.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),"添加到影片库"]}),(0,s.jsx)(g(),{href:"/admin/content/movie-library",children:(0,s.jsx)(i.z,{variant:"outline",type:"button",children:"取消"})})]})]})})]})]})}},5754:function(e,r,t){"use strict";t.d(r,{z:function(){return d}});var s=t(7437),n=t(2265),a=t(7256),i=t(6061),l=t(1657);let c=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,r)=>{let{className:t,variant:n,size:i,asChild:d=!1,...o}=e,u=d?a.g7:"button";return(0,s.jsx)(u,{className:(0,l.cn)(c({variant:n,size:i,className:t})),ref:r,...o})});d.displayName="Button"},7815:function(e,r,t){"use strict";t.d(r,{Ol:function(){return l},SZ:function(){return d},Zb:function(){return i},aY:function(){return o},ll:function(){return c}});var s=t(7437),n=t(2265),a=t(1657);let i=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...n})});i.displayName="Card";let l=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",t),...n})});l.displayName="CardHeader";let c=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("h3",{ref:r,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",t),...n})});c.displayName="CardTitle";let d=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("p",{ref:r,className:(0,a.cn)("text-sm text-muted-foreground",t),...n})});d.displayName="CardDescription";let o=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("p-6 pt-0",t),...n})});o.displayName="CardContent",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("flex items-center p-6 pt-0",t),...n})}).displayName="CardFooter"},5179:function(e,r,t){"use strict";t.d(r,{I:function(){return i}});var s=t(7437),n=t(2265),a=t(1657);let i=n.forwardRef((e,r)=>{let{className:t,type:n,...i}=e;return(0,s.jsx)("input",{type:n,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...i})});i.displayName="Input"},3444:function(e,r,t){"use strict";t.d(r,{g:function(){return i}});var s=t(7437),n=t(2265),a=t(1657);let i=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("textarea",{className:(0,a.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...n})});i.displayName="Textarea"},1657:function(e,r,t){"use strict";t.d(r,{cn:function(){return a}});var s=t(7042),n=t(4769);function a(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n.m6)((0,s.W)(r))}},4033:function(e,r,t){e.exports=t(5313)}},function(e){e.O(0,[61,465,396,971,938,744],function(){return e(e.s=3451)}),_N_E=e.O()}]);